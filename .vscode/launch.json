{
    "version": "0.2.0",
    "inputs": [],
    "configurations": [
        {
            // using Native Debugging / WebFreak extension
            "name": "GDB OpenOCD using OpenOCD pipe",
            "type": "gdb",
            //"request": "attach",
            "request": "attach",
            "executable": "${workspaceFolder}/software/c/finka/pico-hello/build/hello_world.elf",
            "remote": true,
            //"target": "| /opt/openocd-riscv/bin/openocd -c \"gdb_port pipe; log_output openocd.log\" -c \"set MURAX_CPU0_YAML ./cpu0.yaml\" -f \"interface/jtag_tcp.cfg\" -f \"./software/c/finka/pico-hello/finka.cfg\"",
            "target": ":3333",
            "cwd": "${workspaceRoot}",
            "gdbpath": "riscv32-unknown-elf-gdb",
            "autorun": [
              //"set mem inaccessible-by-default off",
              "set architecture riscv:rv32",
              "set remotetimeout unlimited",
              "interrupt",
              "monitor reset halt",
              //"monitor [target current] configure -event gdb-detach {shutdown}",
              "load"
            ]
        },
        
        // using C/C++
        {
            "name": "CPPDBG GDB using OpenOCD pipe",
            "type": "cppdbg",
            "request": "launch",
            "cwd": "${workspaceFolder}",
            "program": "${workspaceFolder}/software/c/finka/pico-hello/build/hello_world.elf",
            "stopAtEntry": false,
            "stopAtConnect": false,
            //"targetArchitecture": "riscv:rv32",
            "environment": [],
            "externalConsole": false,
            // upload task in tasks.json should upload program into target RAM
            // (have not been able to do it here, at least not with OpenOCD GDB pipe)
            "preLaunchTask": "upload",
            "setupCommands": [
                { "text": "set remotetimeout 30" },
                { "text": "-enable-pretty-printing" },
                { "text": "set arch riscv:rv32" },
                {
                  "text": "-interpreter-exec console \"set print thread-events off\"" }
                 }

            ],
            "postRemoteConnectCommands": [
                {
                    "description": "Respect Hardware Limitations",
                    "text": "set remote hardware-watchpoint-limit 2",
                    "ignoreFailures": false
                },
                {
                    "description": "Hard Reset and Immediately Halt",
                    "text": "monitor reset cont",
                    "ignoreFailures": false
                },
            ],
            "MIMode": "gdb",
            "miDebuggerPath": "riscv32-unknown-elf-gdb",
            "miDebuggerServerAddress": "| /opt/openocd-riscv/bin/openocd -c \"gdb_port pipe; log_output openocd.log\" -c \"set MURAX_CPU0_YAML ./cpu0.yaml\" -f \"interface/jtag_tcp.cfg\" -f \"./software/c/finka/pico-hello/finka.cfg\"",
            "useExtendedRemote": true,

            "logging": {
                "exceptions": true,
                "engineLogging": false,
                "moduleLoad": true,
                "programOutput": true,
                "trace": true,
                "traceResponse": false
            },
        }
    ]
}

// https://github.com/microsoft/vscode-cpptools/issues/9195